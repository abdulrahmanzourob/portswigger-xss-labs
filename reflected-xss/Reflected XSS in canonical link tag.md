### 1️⃣ معلومات عامة

|العنصر|التفاصيل|
|---|---|
|**رابط اللاب**|[Reflected XSS in canonical link tag](https://portswigger.net/web-security/cross-site-scripting/contexts/lab-canonical-link-tag)|
|**تاريخ الحل**|8 / 5 / 2025|
|**نوع الثغرة**|Reflected Cross-Site Scripting (XSS)|

---

### 2️⃣ فهم سيناريو اللاب

الموقع بيعرض مدخل المستخدم جوه:

```html
<link rel="canonical" href="USER_INPUT">
```

وبيعمل Escape للعلامات `<` و`>` و الـ double quotes (`"`)، لكن **ما بيأمنش الـ single quotes (`'`)**، وده اللي هنستغله في الحقن.

---

### ✅ إيه هو الـ Canonical Tag؟

هو وسم (Tag) بيتحط جوه الـ `<head>` في صفحة الويب، مثال:

```html
<link rel="canonical" href="https://example.com/page.html">
```

#### معناه:

بيقول لجوجل ومحركات البحث إن **اللينك ده هو النسخة الأساسية** (الأصلية) للصفحة.

---

### 💡 ليه بنستخدمه؟

علشان لو فيه نسخ كتير من نفس الصفحة (زي صفحات فيها برامتر في الـ URL)، محركات البحث ما تتلغبطش وتفكر إنهم صفحات مختلفة.

✅ مثال:

|URL|معناها|
|---|---|
|`https://example.com/product?id=123`|نسخة فيها برامتر|
|`https://example.com/product`|النسخة الأصلية|

بنستخدم canonical زي كده:

```html
<link rel="canonical" href="https://example.com/product">
```

---

### 😈 إزاي بنستغل ده في اللاب؟

الموقع بياخد input منك وبيحطه جوه:

```html
<link rel="canonical" href="YOUR_INPUT">
```

ومن غير ما يأمنه كويس، فإحنا ممكن:

1. نقفل القيمة بتاعة الـ `href`
    
2. نضيف Attribute جديد فيه كود JavaScript
    
3. نكمل التاج علشان شكله يبان سليم
    

---

### 💻 اختبار أولي:

جربنا نحط:

```
testt " > '
```

والنتيجة:

- المتصفح فلتر الـ double quote (`"`) والـ angle brackets (`< >`)
    
- لكن **ساب الـ single quote (`'`)**
    

وده معناه إننا نقدر نستغل الثغرة بالحقن عن طريق الـ single quotes.

---

### ✅ البايلود المستخدم:

```html
?/'accesskey='x'onclick='alert(0)
```

---

### 📚 شرح البايلود:

#### 🔹 `?/'`

- بداية البايلود، بتحاول تبوز شكل التاج اللي فيه `href`
    
- الهدف منها **نقفل القيمة** بتاعة `href` علشان نقدر نضيف حاجات بعدها
    

#### 🔹 `accesskey='x'`

- Attribute عادي في HTML بيربط مفتاح معين بالرابط
    
- هنا بنستخدمه علشان تمرير الكود مش أكتر
    

#### 🔹 `onclick='alert(0)'`

- ده الـ JavaScript اللي بيتنفذ لما المستخدم يضغط على العنصر
    
- كده لما يضغط ➜ هيتنفذ `alert(0)`
    

---

### 💣 الهدف من البايلود:

حقن JavaScript في التاج بتاع `<link rel="canonical">` أو `<a>` علشان يتنفذ لما المستخدم يتفاعل مع الصفحة.

---

### 💡 مثال عملي:

لو فيه كود زي ده في الصفحة:

```html
<a href="/page?user=USER_INPUT">Click here</a>
```

وانت دخلت البايلود:

```
?/'accesskey='x'onclick='alert(0)
```

هيتحول لكده:

```html
<a href="/page?/'accesskey='x'onclick='alert(0)">Click here</a>
```

ومع الضغط ➜ يحصل `alert(0)`

---

### 🧠 هستفاد إيه من ده؟ وليه مهم؟

#### ✅ اللي استفدته:

- فهمت إزاي الـ canonical tag ممكن يكون فيه ثغرة XSS
    
- عرفت إزاي أتأكد من أنواع الـ encoding أو الـ escaping اللي الموقع بيعمله
    
- اكتسبت خبرة في استغلال الـ Attributes بدل ما أعتمد بس على `<script>`
    

#### 🧠 ليه مهم؟

- النوع ده من الـ XSS بيكون مخادع ومش واضح، وده بيخليه خطير أكتر
    
- فهمك للسيناريوهات دي بيساعدك تكتب أكواد Web آمنة، أو تكتشف ثغرات حقيقية في مواقع تانية
