## 1๏ธโฃ ูุนูููุงุช ุนุงูุฉ

|ุงูุนูุตุฑ|ุงูุชูุงุตูู|
|---|---|
|**ุฑุงุจุท ุงููุงุจ**|[DOM XSS in `document.write` sink using source `location.search` inside a select element](https://portswigger.net/web-security/cross-site-scripting/dom-based/lab-document-write-sink-inside-select-element)|
|**ุชุงุฑูุฎ ุงูุญู**|29 / 4 / 2025|
|**ููุน ุงูุซุบุฑุฉ**|DOM Cross-Site Scripting (XSS)|

---

## 2๏ธโฃ ููู ุณููุงุฑูู ุงููุงุจ

- ุงููููุน ูุนุฑุถ ุตูุญุฉ ุงูููุชุฌ ุจุงูุดูู ุงูุชุงูู:

![Pasted image](../images/Pasted%20image%2020250429010034.png)

- ุงูููุฑุฉ ุฃู ุงููููุน ูุฌูุจ ุงูููุชุฌ ุจูุงุกู ุนูู ุงูุจุงุฑุงููุชุฑ ุงูููุฌูุฏ ูู ุงูุฑุงุจุท ููู `productId=1`.


---

### ๐ ุชุญููู ุงูููุฏ ุงููุตุฏุฑ (Source Code)

- ุฃุซูุงุก ูุญุต ุงูููุฏ ุงููุตุฏุฑ ูุฌุฏุช ุงูููุฏ ุงูุชุงูู:


```javascript
var stores = ["London", "Paris", "Milan"];
var store = (new URLSearchParams(window.location.search)).get('storeId');

document.write('<select name="storeId">');

if (store) {
  document.write('<option selected>' + store + '</option>');
}

for (var i = 0; i < stores.length; i++) {
  if (stores[i] === store) {
    continue;
  }
  document.write('<option>' + stores[i] + '</option>');
}

document.write('</select>');
```

#### ุดุฑุญ ุงูููุฏ:

- ููุงู ูุตูููุฉ ุชุญุชูู ุนูู ุฃุณูุงุก ูุฎุงุฒู ุซุงุจุชุฉ: `London`, `Paris`, `Milan`.

- ูุชู ุงุณุชุฎุฑุงุฌ ูููุฉ **`storeId`** ูู **`location.search`** (ุฃู ูู ุฑุงุจุท ุงูุตูุญุฉ).

- ูุชู ุฅูุดุงุก ุนูุตุฑ **`<select>`** ุฌุฏูุฏ ุจุงุณุชุฎุฏุงู `document.write`.

- ุฅุฐุง ูุงูุช ููุงู ูููุฉ ูู `storeId`ุ ุชุชู ุฅุถุงูุชูุง ุฏุงุฎู `<option selected>`.

- ุจููุฉ ุงููุฎุงุฒู ุชุชู ุฅุถุงูุชูุง ูุฎูุงุฑุงุช ุฃุฎุฑู ุฏุงุฎู ููุณ `<select>`.


---

### ุชุฌุฑุจุฉ:

- ููุช ุจุชุฌุฑุจุฉ ูุถุน ูููุฉ ุนุดูุงุฆูุฉ ููููุฉ ูู `storeId` ูุซู:


```
product?productId=1&storeId=z3rob
```

- ุงููุชูุฌุฉ:

    ![Screenshot](../images/Screenshot%202025-04-29%20010617.png)

- ููุง ูู ุธุงูุฑ ุจุงูุตูุฑุฉ: ุงููููุฉ `z3rob` ุธูุฑุช ุฏุงุฎู ุงููุงุฆูุฉ ุงูููุณุฏูุฉ ูุชู ุญูููุง ูุจุงุดุฑุฉ ุจุฏูู ุฃู ูุญุต.


---

## 3๏ธโฃ ููุฑุฉ ุงููุฌูู (Exploit Idea)

- ููุช ุจุฅุฑุณุงู ูุฐุง ุงูุฑุงุจุท:


```
product?productId=1&storeId="></select><img src=1 onerror=alert(1)>
```

### ูุงุฐุง ูุญุฏุซ ููุง ุจุงูุถุจุทุ

#### ุงูุฎุทูุฉ 1: ูุณุฑ ุงูุจูุงุก ุงูุฃุณุงุณู

- ุจุฏุงูุฉ ูููุฉ `storeId` ุจู `">` ุชููู **ุจุฅุบูุงู** ุงููุณู ุงูููุชูุญ `<option>`.


#### ุงูุฎุทูุฉ 2: ูุณุฑ ุนูุตุฑ `<select>`

- ุจุนุฏ ุฐูู ูุชู ุฅุฑุณุงู `</select>` ูุฅุบูุงู ุนูุตุฑ ุงููุงุฆูุฉ ุงูููุณุฏูุฉ `<select>` ุจุงููุงูู.


#### ุงูุฎุทูุฉ 3: ุญูู ุนูุตุฑ ุฌุฏูุฏ

- ูุชู ุจุนุฏูุง ุฅูุดุงุก ุนูุตุฑ ุฌุฏูุฏ `<img>` ูุน ุฎุงุตูุฉ `onerror` ุงูุชู ุชุญุชูู ุนูู `alert(1)`.

- ุจูุง ุฃู ุงูุตูุฑุฉ ุบูุฑ ููุฌูุฏุฉ (src=1)ุ ูุชู ุชูููุฐ ุงูููุฏ ุฏุงุฎู `onerror`.
    
    ![Pasted image](../images/Pasted%20image%2020250429011623.png)
    

### ุงููุชูุฌุฉ:

- ุจูุฌุฑุฏ ุฒูุงุฑุฉ ุงูุฑุงุจุทุ ูุชู ุชูููุฐ ููุฏ **JavaScript** (ุธููุฑ `alert(1)`) ููุง ูุคูุฏ ูุฌูุฏ ุซุบุฑุฉ **DOM XSS** ุจูุฌุงุญ.


---

# โ ููุงุญุธุงุช ุฅุถุงููุฉ:

- ุงูุซุบุฑุฉ ููุฌูุฏุฉ ูุฃู ุงูููุฏ ูุฏูุฌ ูุฏุฎูุงุช ุงููุณุชุฎุฏู ูุจุงุดุฑุฉู ุฏุงุฎู HTML ุนุจุฑ `document.write` ุจุฏูู ุฃู ูุญุต ุฃู ุชุฑููุฒ (Sanitization / Escaping).

- ุงุณุชุฎุฏุงู `document.write` ุฎุทูุฑ ููุบุงูุฉ ูููุนุชุจุฑ ูู **ุงูู Bad Practices** ูู ุงูุจุฑูุฌุฉ ุงูุญุฏูุซุฉ.

- ูู ุงูููุชุฑุถ ุจุฏููุง ูู `document.write` ุฃู ูุชู ุงุณุชุฎุฏุงู ุชูููุงุช ุฃูุซุฑ ุฃูุงููุง ูุซู `textContent` ุฃู ุฅูุดุงุก ุนูุงุตุฑ DOM ุจุดูู ููููู ุนุจุฑ `createElement`.
