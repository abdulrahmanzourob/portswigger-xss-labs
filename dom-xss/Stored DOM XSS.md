أكيد، إليك نفس المحتوى لكن بشكل أكثر تنظيمًا واحترافية مع المحافظة على **نفس الروابط والصور** اللي أرسلتها:

---

## 🧠 Stored DOM XSS – Write-up

### 1️⃣ معلومات عامة

|العنصر|التفاصيل|
|---|---|
|**رابط اللاب**|[Stored DOM XSS](https://portswigger.net/web-security/cross-site-scripting/dom-based/lab-dom-xss-stored)|
|**تاريخ الحل**|30 / 4 / 2025 (عيد ميلادي 🎉)|
|**نوع الثغرة**|Stored DOM XSS|

---

### 2️⃣ وصف سيناريو اللاب

- صفحة تحتوي على **نموذج لإضافة التعليقات**.
    
- عند إدخال تعليق، يتم عرضه مباشرة في الصفحة، ما يشير إلى احتمال وجود تنفيذ مباشر على DOM.
    

📸  
![[Pasted image 20250430023151.png]]

---

### 3️⃣ تحليل الكود المصدر

- من خلال Burp Suite، تم فحص الـ **response**.
    
- وُجد الكود التالي ضمن سكربت الجافاسكربت:
    

```js
function escapeHTML(html) {
  return html.replace('<', '&lt;').replace('>', '&gt;');
}
```

#### ⚠️ ملاحظة مهمة:

- الدالة `replace()` تقوم باستبدال **أول تطابق فقط**.
    
- فمثلًا لو كتبنا الكود التالي في التعليق:
    

```html
<h1>z3rob</h1>
```

- النتيجة في الصفحة كانت:
    

📸  
![[Pasted image 20250430023738.png]]

- كما هو واضح، `<` الأولى فقط تم تحويلها إلى `&lt;`، والباقي بقي HTML فعّال.
    

---

### 4️⃣ الاستغلال العملي

- باستغلال هذا الخلل، قمنا بإرسال الكود التالي:
    

```html
<><img src=x onerror=confirm()>
```

#### ✅ لماذا يعمل هذا الكود؟

- `<><img...>`:
    
    - `<` الأولى يتم تجاهلها أو معالجتها بشكل جزئي.
        
    - `<img>` يتم تنفيذه كعنصر HTML.
        
- الحدث `onerror=confirm()` يتم تنفيذه بنجاح لأنه لم يُستبدل بالكامل في الدالة `escapeHTML`.
    

📸  
![[Pasted image 20250430024307.png]]

- ✅ تم تنفيذ كود الـ JavaScript وظهور `alert()`.
